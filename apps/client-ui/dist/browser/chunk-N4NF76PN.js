import{a as Z,c as K,d as $e}from"./chunk-BRHM5YYY.js";import{o as Ge}from"./chunk-TJ6H6A5R.js";import"./chunk-TT3YQ3US.js";import{a as Le}from"./chunk-OTGNVC4O.js";import{a as S}from"./chunk-VH7JZYVM.js";import{s as se}from"./chunk-HIMNRRUG.js";import{$c as J,Ae as je,Da as m,Ea as de,Fa as Q,Fd as _e,Gb as fe,Hb as be,Ib as z,Id as Me,Jb as W,L as a,Lb as re,Ld as Fe,M as c,Nb as he,Oa as ue,Ob as ne,Qb as ge,Rb as ve,Td as ke,Ud as Ee,Vb as Ce,X as j,Xb as ye,Zb as we,_b as Ne,aa as p,d as B,dc as Re,dd as Ie,ec as Se,ed as Pe,fd as C,fe as R,gc as Te,gd as y,h as d,ha as r,hb as q,i as A,ia as s,id as w,ja as f,le as Oe,md as xe,na as G,nd as N,od as De,p as V,q as U,qa as F,sa as ce,ue as Be,va as pe,xa as $,xe as Ae,ya as L,ye as Ve,za as H,ze as Ue}from"./chunk-UTWBPGI3.js";import{I as ae,Tb as le,Y as me}from"./chunk-YM5U3RH6.js";import{f as i}from"./chunk-4X66MCCG.js";var T=class T{};i(T,"\u0275fac",function(e){return new(e||T)}),i(T,"\u0275cmp",d({type:T,selectors:[["ngx-roles"]],decls:1,vars:0,template:function(e,o){e&1&&f(0,"router-outlet")},dependencies:[be],encapsulation:2}));var X=T;var I=class I{constructor(){i(this,"value");i(this,"rowData");i(this,"linkUrl");i(this,"linkText");i(this,"url")}ngOnInit(){if(this.linkText=this.value,this.rowData?.id!=null){let t=this.linkUrl.startsWith("/")||this.linkUrl===""?this.linkUrl:"/"+this.linkUrl;this.url=`${t}/${this.rowData.id}`}else this.url=this.linkUrl||"/"}};i(I,"\u0275fac",function(e){return new(e||I)}),i(I,"\u0275cmp",d({type:I,selectors:[["ng-component"]],inputs:{value:"value",rowData:"rowData",linkUrl:"linkUrl"},decls:2,vars:2,consts:[["size","small","shape","round","nbButton","","outline","","status","success",3,"routerLink"]],template:function(e,o){e&1&&(r(0,"a",0),m(1),s()),e&2&&(p("routerLink",o.url),a(),Q(" ",o.linkText," "))},dependencies:[W,N],encapsulation:2}));var h=I;var ze=["table"],P=class P{constructor(t,e,o){this.service=t;this.router=e;this.toastrService=o;i(this,"smartTable");i(this,"settings",{actions:{columnTitle:"Acciones",add:!0,edit:!0,position:"right",delete:!0},hideSubHeader:!1,add:{addButtonContent:'<i class="nb-plus"></i>',createButtonContent:'<i class="nb-checkmark"></i>',cancelButtonContent:'<i class="nb-close"></i>'},edit:{editButtonContent:'<i class="nb-edit"></i>',saveButtonContent:'<i class="nb-checkmark"></i>',cancelButtonContent:'<i class="nb-close"></i>'},delete:{deleteButtonContent:'<i class="nb-trash"></i>',confirmDelete:!0},mode:"external",columns:{id:{title:"ID",type:"text",isFilterable:!1,isEditable:!1},name:{title:"Nombre",type:"custom",renderComponent:h,componentInitFunction:t=>{t.linkUrl=""},isFilterable:!1,isEditable:!1},last_update:{title:"\xDAltima Actualizaci\xF3n",type:"text",isFilterable:!1,isEditable:!1},permissions_count:{title:"Permisos",type:"text",isFilterable:!1,isEditable:!1},users_count:{title:"Usuarios",type:"custom",renderComponent:h,componentInitFunction:t=>{t.linkUrl="/users"},isFilterable:!1,isEditable:!1}}});i(this,"source",new Z);i(this,"roles",[]);i(this,"index",0);this.service.getAll().subscribe(n=>{this.roles=n,this.source.load(n)})}ngAfterViewInit(){this.smartTable.edit.subscribe(t=>{this.router.navigateByUrl("/pages/roles/"+t.data.id)}),this.smartTable.create.subscribe(()=>{this.router.navigateByUrl("/pages/roles/add")}),this.smartTable.delete.subscribe(t=>{this.onDeleteConfirm(t)})}onDeleteConfirm(t){window.confirm("Seguro que desea borrar?")&&this.service.deleteRole(t.data.id).subscribe({next:e=>{e?(this.showToast(J.TOP_RIGHT,"success","Borrado Correctamente"),this.roles=this.roles.filter(o=>o!==t.data),this.source.load(this.roles)):this.showToast(J.TOP_RIGHT,"danger","Error al borrar")},error:()=>{this.showToast(J.TOP_RIGHT,"danger","Error al borrar")}})}showToast(t,e,o){this.index+=1,this.toastrService.show(o,"Informaci\xF3n",{limit:3,position:t,status:e})}};i(P,"\u0275fac",function(e){return new(e||P)(c(S),c(z),c(R))}),i(P,"\u0275cmp",d({type:P,selectors:[["ngx-roles-view"]],viewQuery:function(e,o){if(e&1&&$(ze,5),e&2){let n;L(n=H())&&(o.smartTable=n.first)}},decls:6,vars:2,consts:[["table",""],[1,"table","table-hover",3,"deleteConfirm","settings","source"]],template:function(e,o){if(e&1){let n=G();r(0,"nb-card")(1,"nb-card-header"),m(2," Gesti\xF3n de Roles "),s(),r(3,"nb-card-body")(4,"angular2-smart-table",1,0),F("deleteConfirm",function(M){return V(n),U(o.onDeleteConfirm(M))}),s()()()}e&2&&(a(4),p("settings",o.settings)("source",o.source))},dependencies:[w,y,C,K],styles:[`[_nghost-%COMP%]   nb-card[_ngcontent-%COMP%]{transform:translateZ(0)}





`]}));var ee=P;function Je(u,t){if(u&1){let e=G();r(0,"div",13)(1,"nb-toggle",14),F("change",function(n){let l=V(e).index,M=ce();return U(M.onCheckboxChange(n,l))}),m(2),s()()}if(u&2){let e=t.$implicit,o=t.index;a(),pe("status",e.active?"basic":"success"),p("formControlName",o)("checked",e.active),a(),Q(" ",e.name," ")}}var x=class x{constructor(t,e,o,n){this.route=t;this.service=e;this.fb=o;this.toastrService=n;i(this,"role$");i(this,"role",new se);i(this,"systemPermissions$");i(this,"systemPermission");i(this,"selectedId");i(this,"form");i(this,"apis");i(this,"index",0);this.form=this.fb.group({id:[""],last_update:[""],name:["",ne.required],description:[""],permissions:new Re([])}),this.role$=this.route.paramMap.pipe(le(l=>(this.selectedId=l.get("id"),this.selectedId==="add"?ae(new se([])):this.service.getSingle(this.selectedId)))),this.systemPermissions$=this.service.getSystemPermissions(),me([this.systemPermissions$,this.role$]).subscribe({next:([l,M])=>{this.role=M,this.systemPermission=l,this.form=this.fb.group({id:[this.role.id],last_update:[this.role.update_at],name:[this.role.name,ne.required],description:[this.role.description],permissions:this.buildPermissions()})},error:l=>{this.showToast("top-right","danger",l)},complete:()=>{}})}save(){this.form.get("id").value!==""?(this.role.name=this.form.get("name").value,this.role.description=this.form.get("description").value,this.role$=this.service.updateRole(this.role)):(this.role.id="",this.role.name=this.form.get("name").value,this.role.description=this.form.get("description").value,this.role$=this.service.addRole(this.role)),this.role$.subscribe({next:t=>{t?this.showToast("top-right","success","Guardado Correctamente"):this.showToast("top-right","danger","Error al guardar")},error:t=>{this.showToast("top-right","success",t)},complete:()=>{}})}delete(t){this.service.deleteRole(t).subscribe()}trackByMethod(t,e){return e.id}buildPermissions(){let t=0,e=!1,o=[];return this.systemPermission.map(n=>{this.role.permissions.map(l=>{if(l.name===n.name){e=!0;return}}),o[t]=e,e=!1,t++}),this.fb.array(o)}onCheckboxChange(t,e){if(t.target.checked)this.role.permissions.push(this.systemPermission[e]),this.systemPermission[e].active=!0;else{let o=0;this.role.permissions.forEach(n=>{if(n.name===this.systemPermission[e].name){this.role.permissions.splice(o,1),this.systemPermission[e].active=!1;return}o++})}}showToast(t,e,o){this.index+=1,this.toastrService.show(o,"Informaci\xF3n",{limit:3,position:t,status:e})}};i(x,"\u0275fac",function(e){return new(e||x)(c(fe),c(S),c(Se),c(R))}),i(x,"\u0275cmp",d({type:x,selectors:[["ngx-role-edit"]],decls:26,vars:3,consts:[[3,"ngSubmit","formGroup"],[1,"row"],[1,"col-md-12"],[1,"inline-form-card"],[1,"form-inline"],["formControlName","name","type","text","nbInput","","fullWidth","","status","primary","placeholder","Nombre"],["formControlName","description","type","text","nbInput","","fullWidth","","status","primary","placeholder","Descripci\xF3n"],[1,"form-group","row"],[1,"col-sm-3","label"],["class","col-sm-3","formArrayName","permissions",4,"ngFor","ngForOf","ngForTrackBy"],[1,"offset-sm-5","col-sm-7"],["type","submit","hero","","nbButton","","status","primary"],["icon","save-outline"],["formArrayName","permissions",1,"col-sm-3"],[1,"col-sm-12","items-rows",3,"change","formControlName","status","checked"]],template:function(e,o){e&1&&(r(0,"form",0),F("ngSubmit",function(){return o.save()}),r(1,"div",1)(2,"div",2)(3,"nb-card",3)(4,"nb-card-header"),m(5,"Role"),s(),r(6,"nb-card-body")(7,"div",4),f(8,"input",5)(9,"input",6),s()()()()(),r(10,"div",1)(11,"div",2)(12,"nb-card")(13,"nb-card-header"),m(14,"Permisos"),s(),r(15,"nb-card-body")(16,"div",7)(17,"label",8),m(18,"Permisos disponibles"),s(),r(19,"div",1),j(20,Je,3,4,"div",9),s()(),r(21,"div",7)(22,"div",10)(23,"button",11),f(24,"nb-icon",12),m(25,"Guardar"),s()()()()()()()()),e&2&&(p("formGroup",o.form),a(20),p("ngForOf",o.systemPermission)("ngForTrackBy",o.trackByMethod))},dependencies:[w,y,C,Ie,ke,q,N,Ue,Ce,he,ge,ve,ye,Ne,we],styles:[".form-inline[_ngcontent-%COMP%]   [fullWidth][_ngcontent-%COMP%]{flex:1}.form-inline[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:0 1.5rem 1.5rem 0}nb-card.inline-form-card[_ngcontent-%COMP%]   nb-card-body[_ngcontent-%COMP%]{padding-bottom:0}.items-rows[_ngcontent-%COMP%]{align-items:center;max-height:200px}nb-toggle[_ngcontent-%COMP%]:not(:only-child){margin-right:1.5rem}nb-toggle[_ngcontent-%COMP%]{margin-bottom:1rem}"]}));var O=x;var Ze=u=>[u];function Ke(u,t){if(u&1&&(r(0,"div",2)(1,"a",3),m(2),s()()),u&2){let e=t.$implicit;a(),p("routerLink",ue(2,Ze,"/pages/roles/"+e.id)),a(),de(e.name)}}var D=class D{constructor(){i(this,"items");i(this,"rowData");i(this,"value")}ngOnInit(){this.items=this.rowData.roles}};i(D,"\u0275fac",function(e){return new(e||D)}),i(D,"\u0275cmp",d({type:D,selectors:[["ng-component"]],inputs:{rowData:"rowData",value:"value"},decls:2,vars:1,consts:[[1,"row"],["class","col-sm-3",4,"ngFor","ngForOf"],[1,"col-sm-3"],["shape","round","size","small","outline","","nbButton","","status","success",3,"routerLink"]],template:function(e,o){e&1&&(r(0,"div",0),j(1,Ke,3,4,"div",1),s()),e&2&&(a(),p("ngForOf",o.items))},dependencies:[q,W,N],encapsulation:2}));var te=D;var Xe=["table"],_=class _{constructor(t,e,o){this.service=t;this._router=e;this._toastrService=o;i(this,"smartTable");i(this,"settings",{actions:{columnTitle:"Acciones",add:!1,edit:!1,position:"right",delete:!1},hideSubHeader:!1,mode:"external",columns:{id:{title:"ID",type:"text",isFilterable:!1,isEditable:!1},name:{title:"Nombre",type:"text"},roles:{title:"Roles",type:"custom",renderComponent:te,componentInitFunction:t=>{t.items="/roles"},isFilterable:!1,isEditable:!1},users_count:{title:"Usuarios",type:"custom",renderComponent:h,componentInitFunction:t=>{t.linkUrl="/users"},isFilterable:!1,isEditable:!1}}});i(this,"source",new Z);i(this,"permissions",new Array);i(this,"index");let n=this.service.getSystemPermissions().subscribe(l=>{this.permissions=l,this.source.load(l)})}actions(t,e){t.url=e}showToast(t,e,o){this.index+=1,this._toastrService.show(o,"Informaci\xF3n",{limit:3,position:t,status:e})}};i(_,"\u0275fac",function(e){return new(e||_)(c(S),c(z),c(R))}),i(_,"\u0275cmp",d({type:_,selectors:[["ngx-permissions"]],viewQuery:function(e,o){if(e&1&&$(Xe,5),e&2){let n;L(n=H())&&(o.smartTable=n.first)}},decls:6,vars:2,consts:[["table",""],[1,"table","table-hover",3,"settings","source"]],template:function(e,o){e&1&&(r(0,"nb-card")(1,"nb-card-header"),m(2," Visor de Roles "),s(),r(3,"nb-card-body"),f(4,"angular2-smart-table",1,0),s()()),e&2&&(a(4),p("settings",o.settings)("source",o.source))},dependencies:[w,y,C,K]}));var ie=_;var Ye=[{path:"",component:X,children:[{path:"",component:ee},{path:":id",component:O},{path:"add",component:O},{path:"permissions/view",component:ie}]}],g=class g{};i(g,"\u0275fac",function(e){return new(e||g)}),i(g,"\u0275mod",A({type:g})),i(g,"\u0275inj",B({imports:[re.forChild(Ye),re]}));var oe=g;var v=class v{};i(v,"\u0275fac",function(e){return new(e||v)}),i(v,"\u0275mod",A({type:v})),i(v,"\u0275inj",B({imports:[xe,Ve,Pe,Ee,Ge,oe,$e,De,Me,_e,Fe,Ae,Be,Oe,je,Te,Le]}));var Qe=v;export{Qe as RolesModule};
